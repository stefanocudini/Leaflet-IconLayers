/* 
 * Leaflet-IconLayers v0.1.1 - 2015-08-11 
 * 
 * Copyright 2015 Alexander Zverev 
 * alexander.zverev@gmail.com 
 * https://github.com/zverev 
 * 
 * Licensed under the MIT license. 
 * 
 * Demos: 
 * https://github.com/ScanEx/Leaflet-IconLayers 
 * 
 * Source: 
 * https://github.com/ScanEx/Leaflet-IconLayers.git 
 * 
 */
!function(){function a(a,b){for(var c in a)a.hasOwnProperty(c)&&b(a[c],c,a)}function b(a,b){if(a.length){for(var c=0;c<a.length;c++)if(b(a[c]))return a[c]}else for(var d in a)if(a.hasOwnProperty(d)&&b(a[d]))return a[d]}function c(a){for(var b in a)if(a.hasOwnProperty(b))return a[b]}function d(a){var b=0;for(var c in a)a.hasOwnProperty(c)&&b++;return b}function e(a,b){a.children.length?a.insertBefore(b,a.children[0]):a.appendChild(b)}L.Control.IconLayers=L.Control.extend({includes:L.Mixin.Events,_getActiveLayer:function(){return this._activeLayerId?this._layers[this._activeLayerId]:d(this._layers)?c(this._layers):null},_getPreviousLayer:function(){var a=this._getActiveLayer();return a?this._previousLayerId?this._layers[this._previousLayerId]:b(this._layers,function(b){return b.id!==a.id}.bind(this))||null:null},_getInactiveLayers:function(){var b=[],c=this._getActiveLayer()?this._getActiveLayer().id:null,d=this._getPreviousLayer()?this._getPreviousLayer().id:null;return a(this._layers,function(a){a.id!==c&&a.id!==d&&b.push(a)}),b},_arrangeLayers:function(){var a={};return a.previous=function(){var a=this._getInactiveLayers();return this._getActiveLayer()&&a.unshift(this._getActiveLayer()),this._getPreviousLayer()&&a.unshift(this._getPreviousLayer()),a},a[this.options.behavior].apply(this,arguments)},_getLayerCellByLayerId:function(a){for(var b=this._container.getElementsByClassName("leaflet-iconLayers-layerCell"),c=0;c<b.length;c++)if(b[c].getAttribute("data-layerid")==a)return b[c]},_createLayerElement:function(a){var b=L.DomUtil.create("div","leaflet-iconLayers-layer");if(a.title){var c=L.DomUtil.create("div","leaflet-iconLayers-layerTitleContainer"),d=L.DomUtil.create("div","leaflet-iconLayers-layerTitle"),e=L.DomUtil.create("div","leaflet-iconLayers-layerCheckIcon");d.innerHTML=a.title,c.appendChild(d),b.appendChild(c),b.appendChild(e)}return a.icon&&b.setAttribute("style","background-image: url('"+a.icon+"')"),b},_createLayerElements:function(){for(var a,b,c=this._arrangeLayers(),d=this._getActiveLayer()&&this._getActiveLayer().id,f=0;f<c.length;f++)f%this.options.maxLayersInRow===0&&(a=L.DomUtil.create("div","leaflet-iconLayers-layersRow"),-1===this.options.position.indexOf("bottom")?this._container.appendChild(a):e(this._container,a)),b=L.DomUtil.create("div","leaflet-iconLayers-layerCell"),b.setAttribute("data-layerid",c[f].id),0!==f&&L.DomUtil.addClass(b,"leaflet-iconLayers-layerCell_hidden"),c[f].id===d&&L.DomUtil.addClass(b,"leaflet-iconLayers-layerCell_active"),"left"===this._expandDirection?L.DomUtil.addClass(b,"leaflet-iconLayers-layerCell_expandLeft"):L.DomUtil.addClass(b,"leaflet-iconLayers-layerCell_expandRight"),b.appendChild(this._createLayerElement(c[f])),-1===this.options.position.indexOf("right")?a.appendChild(b):e(a,b)},_onLayerClick:function(a){a.stopPropagation();var b=a.currentTarget.getAttribute("data-layerid"),c=this._layers[b];this.setActiveLayer(c.layer),this.expand()},_attachEvents:function(){a(this._layers,function(a){var b=this._getLayerCellByLayerId(a.id);b&&b.addEventListener("click",this._onLayerClick.bind(this))}.bind(this));for(var b=this._container.getElementsByClassName("leaflet-iconLayers-layersRow"),c=0;c<b.length;c++){var d=b[c];d.addEventListener("mouseenter",function(a){a.stopPropagation(),this.expand()}.bind(this)),d.addEventListener("mouseleave",function(a){a.stopPropagation(),this.collapse()}.bind(this)),d.addEventListener("mousemove",function(a){a.stopPropagation()})}},_render:function(){this._container.innerHTML="",this._createLayerElements(),this._attachEvents()},_switchMapLayers:function(){if(this._map){var b=this._getActiveLayer(),c=this._getPreviousLayer();c?this._map.removeLayer(c.layer):a(this._layers,function(a){var b=a.layer;this._map.removeLayer(b)}.bind(this)),b&&this._map.addLayer(b.layer)}},options:{position:"bottomleft",behavior:"previous",expand:"horizontal",autoZIndex:!0,maxLayersInRow:5,manageLayers:!0},initialize:function(a,b){L.Util.isArray(arguments[0])||(b=a,a=[]),L.setOptions(this,b),this._expandDirection=-1!=this.options.position.indexOf("left")?"right":"left",this.options.manageLayers&&this.on("activelayerchange",this._switchMapLayers,this),this.setLayers(a)},onAdd:function(a){return this._container=L.DomUtil.create("div","leaflet-iconLayers"),L.DomUtil.addClass(this._container,"leaflet-iconLayers_"+this.options.position),this._render(),a.on("click",this.collapse,this),this.options.manageLayers&&this._switchMapLayers(),this._container},onRemove:function(a){a.off("click",this.collapse,this)},setLayers:function(a){this._layers={},a.map(function(a){var b=L.stamp(a.layer);this._layers[b]=L.extend(a,{id:b})}.bind(this)),this._container&&this._render()},setActiveLayer:function(a){var b=a&&this._layers[L.stamp(a)];b&&b.id!==this._activeLayerId&&(this._previousLayerId=this._activeLayerId,this._activeLayerId=b.id,this._container&&this._render(),this.fire("activelayerchange",{layer:a}))},expand:function(){this._arrangeLayers().slice(1).map(function(a){var b=this._getLayerCellByLayerId(a.id);L.DomUtil.removeClass(b,"leaflet-iconLayers-layerCell_hidden")}.bind(this))},collapse:function(){this._arrangeLayers().slice(1).map(function(a){var b=this._getLayerCellByLayerId(a.id);L.DomUtil.addClass(b,"leaflet-iconLayers-layerCell_hidden")}.bind(this))}})}(),L.control.iconLayers=function(a,b){return new L.Control.IconLayers(a,b)};